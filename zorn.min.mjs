"use strict";function ot(t){var n=W,i=a,e=l,s=t.length===0,r=s?n:new U;W=a=r,l=!1;try{return t(s?void 0:function(){P(r)})}finally{W=n,a=i,l=e}}function lt(t){return new v(8192,g,t,0)}function at(t,n){return new v(0,g,t,n)}function ut(t,n){return new F(t,n)}function _t(t,n,i,e){return new h(t,n,1,i,null,e)}function ht(t,n,i,e){return new h(t,n,0,i,null,e)}function ft(t,n,i,e,s){return new h(n,i,16385,e,t,s)}function ct(t,n,i,e,s){return new h(et(t,n),i,16384,e,null,s)}function pt(t,n,i){return new h(t,n,1,i)._value}function vt(t,n,i){return new h(t,n,0,i)._value}function dt(t,n,i,e,s){return new h(n,i,16385|(e?32768:0),s,t)._value}function gt(t,n,i,e,s){return new h(et(t,n),i,16384|(e?32768:0),s)._value}function P(t){t._opt&6||(c===0?t._dispose(b):(t._opt|=2,I._add(t)))}function yt(t){var n=l;l=!1;var i=t();return l=n,i}function wt(t){if(c===0){j(),c=1;try{t(),q()}finally{c=0}}else t()}function bt(){l&&(a._opt|=1)}function kt(t){var n=a;n!==null&&n._addCleanup(t)}function Mt(t){var n=a;n!==null&&n._addRecover(t)}function w(t){this._stage=t,this._items=[],this._count=0}w.prototype._add=function(t){this._items[this._count++]=t},w.prototype._run=function(t){c=this._stage;for(var n=0,i=0;i<this._count;i++){var e=this._items[i];if(e._opt&10)try{e._opt&8?e._update(t):e._dispose(t)}catch(s){n=1}finally{e._opt&=-249}else e._opt&=-225;this._items[i]=null}return this._count=0,n};var g={},Ut=[],b=1,c=0,I=new w(2),O=new w(3),T=new w(4),L=new w(5),W=null,a=null,l=!1;function k(t,n,i,e,s){function r(){}var o=r.prototype={};if(n!==void 0)for(var u=0;u<n.length;u++){var p=n[u].prototype;for(var $ in p)o[$]=p[$]}if(i!==void 0){var m={peek:{get:i},val:{get:e}};s!==void 0&&(m.length={get:s}),Object.defineProperties(o,m)}t.prototype=new r,t.constructor=t}function M(t){throw new Error(t)}function j(){I._count=O._count=T._count=L._count=0}function R(t,n){t._opt|=512,n._opt|=2048;var i,e=n._source1===null?-1:n._sources===null?0:n._sources.length;t._node1===null?(i=-1,t._node1=n,t._node1slot=e):t._nodes===null?(t._opt|=1024,i=0,t._nodes=[n],t._nodeslots=[e]):(t._opt|=1024,i=t._nodes.length,t._nodes[i]=n,t._nodeslots[i]=e),n._source1===null?(n._source1=t,n._source1slot=i):n._sources===null?(n._opt|=4096,n._sources=[t],n._sourceslots=[i]):(n._opt|=4096,n._sources[e]=t,n._sourceslots[e]=i)}function q(){var t=a;try{G()}finally{c=0,a=t,l=!1}}function G(){var t,n=0,i=0,e=I,s=O,r=T,o=L;do t=++b,e._count!==0&&(i+=e._run(t)),s._count!==0&&(i+=s._run(t)),r._count!==0&&(i+=r._run(t)),o._count!==0&&(i+=o._run(t)),i!==0&&M("error encountered"),n++>1e5&&M("cycle detected");while(s._count!==0||e._count!==0||r._count!==0||o._count!==0)}function U(){this._opt=0,this._children=[],this._cleanups=null,this._recovers=null}function V(t,n){t._opt=4;var i,e,s=t._children,r=t._cleanups;if(s!==null&&(e=s.length)!==0)for(i=0;i<e;i++)s[i]._dispose(n);if(r!==null&&(e=r.length)!==0)for(i=0;i<e;i++)r[i](!0);t._cleanups=t._children=t._recovers=null}k(U);var x=U.prototype;x._dispose=function(t){V(this,t)},x._addChild=function(t){this._opt|=256,this._children===null?this._children=[t]:this._children[this._children.length]=t},x._addCleanup=function(t){this._cleanups===null?this._cleanups=[t]:this._cleanups[this._cleanups.length]=t},x._addRecover=function(t){this._recovers===null?this._recovers=[t]:this._recovers[this._recovers.length]=t};function C(t){t._opt=4;var n,i=t._node1,e=t._nodes;if(i!==null&&(Q(i,t._node1slot),t._node1=null),e!==null&&(n=e.length)!==0)for(var s=t._nodeslots;n--!==0;)Q(e.pop(),s.pop());t._owner=t._eq=t._nodes=t._nodeslots=null}function H(t,n){if(t._opt!==4)if(n===-1)t._node1=null,t._opt&1024||(t._opt&=-513);else{var i=t._nodes,e=t._nodeslots,s=i.pop(),r=e.pop(),o=i.length;n!==o&&(i[n]=s,e[n]=r,r===-1?s._source1slot=n:s._sourceslots[r]=n),o===0&&(t._opt&=~(1024|(t._node1===null?512:0)))}}function Q(t,n){if(t._opt!==4)if(n===-1)t._source1=null;else{var i=t._sources,e=t._sourceslots,s=i.pop(),r=e.pop(),o=i.length;n!==o&&(i[n]=s,e[n]=r,r===-1?s._node1slot=n:s._nodeslots[r]=n),o===0&&(t._opt&=-4097)}}function D(t,n){var i,e=t._node1,s=t._nodes;if(e!==null&&e._age!==n&&e._recUpdate(n),s!==null&&(i=s.length)>0)for(var r=0;r<i;r++)e=s[r],e._age!==n&&e._recUpdate(n)}function z(t,n){var i=t._node1,e=t._nodes;i!==null&&i._age!==n&&!(i._opt&64)&&i._recMayUpdate(n);var s;if(e!==null&&(s=e.length)>0)for(var r=0;r<s;r++)i=e[r],i._age!==n&&!(i._opt&64)&&i._recMayUpdate(n)}function B(t,n){for(var i=t.length,e=0;e<i;e++){var s=t[e];s._opt&6||s._recDispose(n)}}function J(t,n,i){for(var e=n.length,s=0;s<e;s++){var r=n[s];r._opt&38||r._recMayDispose(t,i)}}function Dt(){}Dt.prototype._clearMayUpdate=function(t,n){};function v(t,n,i,e){this._opt=t|(e==!1?8192:e===void 0?0:65536),this._value=i,this._owner=null,this._eq=e,this._node1=null,this._node1slot=-1,this._nodes=null,this._nodeslots=null,this._set=n;var s=a;s!==null&&s._addChild(this)}function K(){return this._value}function X(){return!(this._opt&6)&&l&&R(this,a),this._value}k(v,[],K,X);var E=v.prototype;function Y(t){var n=this._opt;t:if(!(n&6)&&(n&8192||(n&65536?!this._eq(t,this._value):t!==this._value))){var i=b,e=c;if(e===4&&n&32){if(n&128)throw new Error;if(this._opt|=128,this._owner._clearMayUpdate(e,i),this._opt&=-225,this._opt&6)break t}this._set!==g&&t!==this._set&&M("conflicting values"),this._set=t,e===0?(j(),this._update(b+1),q()):(this._opt|=8,O._add(this))}}E.set=Y,E._dispose=function(t){C(this),this._set=null,this._value=void 0},E._recDispose=function(t){this._opt=2},E._recMayDispose=function(t,n){this._opt|=32,this._owner===null&&(this._owner=t)},E._update=function(t){this._value=this._set,this._set=g,this._opt&=-233,this._opt&512&&D(this,t)};function h(t,n,i,e,s,r){v.call(this,i,t.length<3?t:Et(this,t),n,r),this._children=null,this._cleanups=null,this._recovers=null,this._age=0,this._source1=null,this._source1slot=0,this._sources=null,this._sourceslots=null,this._args=e,i&32768?(this._opt&=-32769,N(this,s)):it(this,!0,this,e,s)}function Z(t){var n=t._opt;!(n&6)&&c!==0&&n&104&&t._clearMayUpdate(c,b)}function tt(){return Z(this),this._value}function nt(){var t=this._opt;return!(t&6)&&c!==0&&(t&104&&this._clearMayUpdate(c,b),!(this._opt&6)&&l&&R(this,a)),this._value}k(h,[U],tt,nt);var y=h.prototype;function it(t,n,i,e,s){var r=a,o=l,u=i._opt;if(a=t,l=n,c===0){j(),c=1;try{u&16384&&N(i,s),i._value=i._set(i._value,e),(O._count!==0||I._count!==0)&&G()}finally{c=0,a=null,l=!1}}else u&16384&&N(this,s),i._value=i._set(i._value,e);a=r,l=o}function Et(t,n){var i=function(){P(t)};return function(e,s){return n(e,s,i)}}function et(t,n){return n.length<3?function(i,e){return t(),l=!1,n(i,e)}:function(i,e,s){return t(),l=!1,n(i,e,s)}}function N(t,n){if(Array.isArray(n))for(var i=n.length,e=0;e<i;e++)R(n[e],t);else R(n,t);l=!1}function st(t){if(t._source1!==null&&(H(t._source1,t._source1slot),t._source1=null),t._opt&4096){var n,i=t._sources;if(i!==null&&(n=i.length)!==0)for(var e=t._sourceslots;n--!==0;)H(i.pop(),e.pop())}t._opt&=-6145}y._dispose=function(t){V(this,t),C(this),st(this),this._set=this._args=this._sources=this._sourceslots=null,this._value=void 0},y._recDispose=function(t){var n=this._opt;this._age=t,this._opt=(n|2)&-9,(n&320)===256&&B(this._children,t)},y._recMayDispose=function(t,n){var i=this._opt;this._opt=(i|32)&-129,this._owner===null&&(this._owner=t),(i&320)===256&&J(this,this._children,n)},y._update=function(t){var n,i,e=a,s=l;a=null,l=!1;var r=this._opt,o=this._children;if(r&256){for(n=0,i=o.length;n<i;n++)o[n]._dispose(t);o.length=0,this._opt&=-257}var u=this._cleanups;if(u!==null&&(i=u.length)!==0){for(n=0;n<i;n++)u[n](!1);u.length=0}a=this,r&1?l=!1:(l=!0,st(this));var p=this._value;this._opt|=16,this._value=this._set(p,this._args),(r&8704)===512&&(r&65536?!this._eq(p,this._value):p!==this._value)&&D(this,t),this._opt&=-249,a=e,l=s},y._recUpdate=function(t){var n=this._opt;this._age=t,this._opt|=8,n&256&&B(this._children,t),(n&8704)===512?(T._add(this),n&64||z(this,t)):(L._add(this),n&512&&D(this,t))},y._recMayUpdate=function(t){var n=this._opt;this._opt=(n|64)&-129,(n&288)===256&&J(this,this._children,t),n&512&&z(this,t)},y._clearMayUpdate=function(t,n){if(t===4){if(this._opt&128&&M("cyclic dependency"),this._opt|=128,this._opt&32&&(this._owner._clearMayUpdate(t,n),this._opt&=-33),(this._opt&70)===64){t:{var i=this._source1;if(i!==null&&i._opt&64&&(i._clearMayUpdate(t,n),this._age===n))break t;if((this._opt&4160)===4160){var e,s=this._sources;if(s!==null&&(e=s.length)>0){for(var r=0;r<e;r++)if(i=s[r],i._opt&64&&(i._clearMayUpdate(t,n),this._age===n))break t}}}this._opt&=-65}this._opt&=-129}this._opt&8&&this._age===n&&(this._opt&16&&M("cyclic dependency"),this._update(n))};function St(t,n){return n.val.length}function rt(){return this._length===null&&(this._length=new h(St,this._value.length,49153,this,this)),this._length}function S(){}k(S,[v]);var _=S.prototype;_.mut=function(){return Z(this),[this._mut[0],this._mut[1]]},_.at=function(t){},_.concat=function(t){},_.every=function(t){},_.filter=function(t){},_.find=function(t){},_.findIndex=function(t){},_.findLast=function(t){},_.findLastIndex=function(t){},_.forEach=function(t){},_.includes=function(t){},_.indexOf=function(t,n){};function It(t,n){var i=n[0],e=n[1];return i._value.join(e)}function At(t,n,i,e,s){for(;n!==i;n+=e)if(t[n]===s)return n;return-1}function Pt(t,n,i,e,s){for(;n!==i;n+=e)if(s(t[n],n))return n;return-1}_.join=function(t){return new h(It,"",16384,[this,t],this)};function Ot(t,n){return n[0]._value.lastIndexOf(n[1],n[2])}_.lastIndexOf=function(t,n){return new h(Ot,-1,16384,[this,t,n],this)},_.map=function(t){},_.reduce=function(t,n){},_.reduceRight=function(t,n){};function Rt(t,n){n[1]=1;var i=n[0],e=n[4];return i.val.slice(e[0],e[1])}_.slice=function(t,n){return new A(this,Rt,[t,n])};function xt(t,n){}_.some=function(t){return new h(xt,g,49152,[this,t],this)};function F(t,n){v.call(this,8192,g,t||[],n),this._length=null,this._mut=[],this._smut=[],this._args=[null,0,0]}k(F,[v,S],K,X,rt);var d=F.prototype;function f(t,n,i,e,s){t._set!==g&&M("conflicting mutation");var r=t._smut;r[0]=n,r[1]=i,r[2]=e,r[3]=s,Y.call(t,Ut)}d.set=function(t,n){var i=arguments.length;i===1?f(this,1537,0,i,t):i>0&&f(this,770,t,t,[t,n])},d._update=function(t){var n=this._smut,i=n[0],e=n[3],s=this._value;switch(i){case 1537:this._value=e;break;case 770:s[e[0]]=e[1];break;case 67:s.length--;break;case 196:s.length-=e;break;case 69:s[s.length]=e;break;case 198:s.push.apply(s,e);break;case 295:s.shift();break;case 553:s.unshift(e);break;case 682:s.unshift.apply(s,e);break;case 1041:s.reverse();break;case 1042:s.sort(e);break;case 19:break;default:s.splice.apply(s,e)}this._smut=this._mut,this._smut[1]=void 0,this._mut=n,this._set=g,this._opt&=-233,this._opt&512&&D(this,t)},d.pop=function(){var t=this._value.length;t!==0&&f(this,67,t-1,t-1)},d.push=function(t){var n=arguments,i=n.length,e=this._value.length;if(i===1)f(this,69,e,e,t);else if(i>0){for(var s=0,r=new Array(i);s<i;s++)r[s]=n[s];f(this,198,e,e+i-1,r)}},d.reverse=function(){var t=this._value.length;t!==0&&f(this,1041,0,t-1)},d.shift=function(){var t=this._value.length;t!==0&&f(this,295,0,0)},d.sort=function(t){var n=this._value.length;n!==0&&f(this,1042,0,n-1,t)},d.splice=function(t,n,i){var e=arguments,s=e.length;if(s>0){var r,o=this._value.length,u;if(t<0)(t+=o)<0&&(t=0);else if(t>=o){if(s<3)return;t=o,n=0}if(n>=o-t&&(n=o-t),(0|n)>0)if(s>2)if(s-2===n){if(n===1)return f(this,t,t,770,[t,i]);r=911}else r=976;else{if(o===0)return;if(t===0){if(n===1)return f(this,0,0,295);r=424}else n===1?r=267:r=396}else{if(s<3)return;if(s===3){if(t===0)return f(this,0,0,553,i);r=525}else r=654}if(r&512)if(r&128){u=[t,n];for(var p=2;p<s;p++)u[p]=e[p]}else u=[t,n,i];else f(this,r,t,t+n,[t,n]);t=u[0],n=u[1],f(this,r,t,t-n+u.length,u)}},d.unshift=function(t){var n=arguments.length;if(n===1)f(this,0,0,553,t);else if(n>0){for(var i=0,e=new Array(n);i<n;i++)e[i]=arguments[i];f(this,0,this._value.length,682,e)}};function A(t,n,i){v.call(this,16385,n,[]),this._age=0,this._source1=null,this._source1slot=0,this._mut=[0],this._args=[t,1,0,void 0,i],it(null,!1,this,this._args,t)}k(A,[h,S],tt,nt,rt);var Ft=A.prototype;Ft._update=function(t){var n=a,i=l,e=this._args;a=null,l=!1,e[1]=0,e[2]=this._mut[0],e[3]=this._mut[1],this._opt|=16,this._value=this._set(this._value,e),e[1]===1&&D(this,t),this._opt&=-249,a=n,l=i};export{ot as root,yt as peek,wt as batch,bt as stable,Mt as recover,kt as cleanup,P as dispose,lt as data,at as value,ut as array,_t as compute,ht as $compute,ft as computeWhen,ct as $computeWhen,pt as effect,vt as $effect,dt as effectWhen,gt as $effectWhen,U as Root,v as Data,h as Computation,S as Collection,A as Enumerable,F as DataArray};
