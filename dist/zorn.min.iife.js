var Zorn=(function(){function f(a,b,c){var d=g;g=!1;a=a(b,c);g=d;return a}function h(a,b,c,d){Object.defineProperties(a,{val:{get:b,set:d},peek:{get:c}})}function l(){return this.g}function m(a){this.g=a}h(m.prototype,function(){return this.g()},function(){return f(this.g)});function n(a,b,c){this.h=0|b;this.g=c;this.l=null;this.I=-1;this.A=this.i=null;null!==a&&(null===a.m?a.m=[this]:a.m.push(this))}function p(){var a,b=this.l,c=this.i;null!==b&&q(b);if(null!==c&&0<(a=c.length))for(b=0;b<a;b++)q(c[b])}
function r(a){a.h=2;a.g=void 0;a.l=null;a.i=null;a.A=null;var b,c=a.l,d=a.i;null!==c&&(u(c,a.I),a.l=null);if(null!==d&&0!==(b=d.length))for(a=a.A;0!==b--;)u(d.pop(),a.pop())}function v(){this.h=0;this.B=this.o=this.m=null}function w(){this.h=2;var a,b,c=this.m,d=this.o;if(null!==c&&0!==(b=c.length))for(a=0;a<b;a++)c[a].v();this.m=null;if(null!==d&&0!==(b=d.length))for(a=0;a<b;a++)d[a](!0);this.o=null}v.prototype.F=function(){};v.prototype.v=w;function x(a){n.call(this,y,0,a);this.j=z}
function B(){0===(this.h&6)&&g&&C(this);return this.g}function D(a){var b=this.h;if(0===(b&6))if(0===E)0!==(b&32)?(F(),this.g=a,this.D(),G()):this.g=a;else if(this.j===z)this.j=a,this.h|=16,H(I,this);else if(a!==this.j)throw Error("Zorn: Conflict");return a}function J(){this.g=this.j;this.j=z;this.h&=-17;0!==(this.h&32)&&this.D()}function K(){r(this);this.j=void 0}h(x.prototype,B,l,D);x.prototype.F=J;x.prototype.v=K;x.prototype.D=p;function L(a,b){x.call(this,a);this.H=b}
h(L.prototype,B,l,function(a){0===(this.h&6)&&((void 0===this.H?a===this.g:this.H(a,this.g))||D.call(this,a));return a});L.prototype.F=J;L.prototype.v=function(){this.H=null;K.call(this)};L.prototype.D=p;function M(a,b,c,d){var e=y,k=g;n.call(this,e,c);this.u=null;this.G=0;this.B=this.o=this.m=this.C=this.s=null;this.j=a;!1===d&&(this.h|=128);y=this;g=!0;if(0===E){F();E=1;try{this.g=a(b),0===I.g&&0===N.g||O()}finally{E=0,y=null,g=!1}}else this.g=a(b);y=e;g=k}
h(M.prototype,function(){var a=this.h;if(0===(a&6)&&0!==E){if(0!==(a&16)){if(0!==(a&8))throw Error();this.F()}g&&C(this)}return this.g},l);M.prototype.F=function(){var a,b,c=y,d=g;y=null;g=!1;var e=this.h,k=this.o;if(null!==k&&0!==(b=k.length)){for(a=0;a<b;a++)k[a](!1);k.length=0}y=this;(g=0===(e&1))&&P(this);this.h|=8;e=this.B;if(null!==e)try{this.g=this.j(this.g)}catch(t){b=e.length;for(a=0;a<b;a++)e[a](t);e.length=0}else this.g=this.j(this.g);this.h&=-25;y=c;g=d};
M.prototype.v=function(){this.j=null;this.g=void 0;w.call(this);r(this);P(this)};M.prototype.D=p;function q(a){var b=a.h;if(0===(b&6)&&0===(b&16)){a.h|=16;32===(b&160)?H(Q,a):H(R,a);var c=a.m;if(null!==c)for(var d=c.length;0!==d--;)S(c.pop());0!==(b&32)&&a.D()}}function S(a){a.h=4;H(N,a);a=a.m;if(null!==a)for(var b=a.length;0!==b--;)S(a.pop())}function T(a){this.l=a;this.i=[];this.g=0}function H(a,b){a.i[a.g++]=b}
function U(a){E=a.l;for(var b=0,c=0;c<a.g;c++){var d=a.i[c],e=d.h;if(0!==(e&20))try{0!==(e&16)?d.F():d.v()}catch(k){b=1,0!==(e&16)&&(d.g=k,d.h|=64),d.h&=-25}a.i[c]=null}a.g=0;return b}var z={},E=0,N=new T(2),I=new T(3),Q=new T(4),R=new T(5),y=null,g=!1;function F(){N.g=I.g=Q.g=R.g=0}
function C(a){var b=y;a.h|=32;var c=null===b.u?-1:null===b.s?0:b.s.length;if(null===a.l){a.l=b;a.I=c;var d=-1}else null===a.i?(a.i=[b],a.A=[c],d=0):(d=a.i.length,a.i.push(b),a.A.push(c));null===b.u?(b.u=a,b.G=d):null===b.s?(b.s=[a],b.C=[d]):(b.s.push(a),b.C.push(d))}function G(){var a=y;try{O()}finally{E=0,y=a,g=!1}}
function O(){var a=0,b=0;do{0!==N.g&&(b+=U(N));0!==I.g&&(b+=U(I));0!==N.g&&(b+=U(N));0!==Q.g&&(b+=U(Q));0!==R.g&&(b+=U(R));if(0!==b)throw Error("Zorn: Error");if(1E5<a++)throw Error("Zorn: Cycle");}while(0!==I.g||0!==N.g||0!==Q.g||0!==R.g)}function P(a){var b,c=a.u,d=a.s;null!==c&&(V(c,a.G),a.u=null);if(null!==d&&0!==(b=d.length))for(a=a.C;0!==b--;)V(d.pop(),a.pop())}
function V(a,b){if(0===(a.h&6))if(-1===b)a.l=null;else{var c=a.i;a=a.A;var d=c.pop(),e=a.pop();b!==c.length&&(c[b]=d,a[b]=e,-1===e?d.G=b:d.C[e]=b)}}function u(a,b){if(0===(a.h&6))if(-1===b)a.u=null;else{var c=a.s;a=a.C;var d=c.pop(),e=a.pop();b!==c.length&&(c[b]=d,a[b]=e,-1===e?d.I=b:d.A[e]=b)}}return{root:function(a){var b=new v,c=y,d=g;y=b;g=!1;if(0===E)try{a()}finally{y=c,g=d}else a(),y=c,g=d;return b},dispose:function(a){var b=a.h;0===(b&6)&&(0===E?a.v():(a.h=b&-17|4,H(N,a)))},val:function(a){return new m(a)},compute:function(a,b,c){return new M(a,b,1,c)},$compute:function(a,b,c){return new M(a,b,0,c)}
,when:function(a,b,c){var d=Array.isArray(a);if(d){var e=a.length;var k=Array(e)}return function(t){if(d)for(var A=0;A<e;A++)k[A]=a[A].val;else k=a.val;c?c=!1:t=f(b,k,t);return t}},data:function(a){return new x(a)},value:function(a,b){return new L(a,b)},nil:function(){return z},owner:function(){return y},peek:f,freeze:function(a){if(0===E){F();E=1;try{var b=a();G()}finally{E=0}}else b=a();return b}
,recover:function(a){var b=y;null!==b&&(null===b.B?b.B=[a]:b.B.push(a))},cleanup:function(a){var b=y;null!==b&&(null===b.o?b.o=[a]:b.o.push(a))},Data:x,Value:L,Computation:M};})();