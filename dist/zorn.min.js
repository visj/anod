var Zorn=(function(){function f(a){this.g=a}g(f.prototype,{get:function(){return this.g()}},{get:function(){var a=h;h=!1;var b=this.g();h=a;return b}});function g(a,b,c){Object.defineProperties(a,{val:b,peek:c})}function l(){return this.h}function m(a,b,c){this.g=0|b;this.h=c;this.m=null;this.F=-1;this.u=this.l=null;null!==a&&(null===a.i?a.i=[this]:a.i.push(this))}function n(a){var b,c=a.m;a=a.l;null!==c&&p(c);if(null!==a&&0<(b=a.length))for(c=0;c<b;c++)p(a[c])}
function r(a){a.g=2;a.h=void 0;a.m=null;a.l=null;a.u=null;var b,c=a.m,d=a.l;null!==c&&(t(c,a.F),a.m=null);if(null!==d&&0!==(b=d.length))for(a=a.u;0!==b--;)t(d.pop(),a.pop())}function u(){this.g=0;this.A=this.j=this.i=null}function v(){this.g=2;this.h=void 0;var a,b,c=this.i,d=this.j;if(null!==c&&0!==(b=c.length))for(a=0;a<b;a++)c[a].s();this.i=null;if(null!==d&&0!==(b=d.length))for(a=0;a<b;a++)d[a](!0);this.j=null}u.prototype.C=function(){};u.prototype.s=v;
function p(a){var b=a.g;0===(b&6)&&0===(b&16)&&(a.g|=16,32===(b&160)?x(y,a):x(z,a),null!==a.i&&A(a.i),0!==(b&32)&&n(a))}function A(a){for(var b=a.length,c=0;c<b;c++){var d=a[c];d.g=4;x(B,d);d=d.i;null!==d&&(A(d),d.length=0)}}function C(a){m.call(this,D,0,a);this.i=E}function F(){0===(this.g&6)&&h&&G(this);return this.h}
function H(a){var b=this.g;if(0===(b&6))if(0===I)0!==(b&32)?(J(),this.h=a,n(this),K()):this.h=a;else if(this.i===E)this.i=a,this.g|=16,x(L,this);else if(a!==this.i)throw Error("Zorn: Conflict");return a}function M(){this.h=this.i;this.i=E;this.g&=-17;0!==(this.g&32)&&n(this)}function N(){r(this);this.i=void 0}g(C.prototype,{get:F,set:H},{get:l});C.prototype.C=M;C.prototype.s=N;function O(a,b){C.call(this,a);this.j=b}
g(O.prototype,{get:F,set:function(a){0===(this.g&6)&&((void 0===this.j?a===this.h:this.j(a,this.h))||H.call(this,a));return a}},{get:l});O.prototype.C=M;O.prototype.s=function(){this.j=null;N.call(this)};function P(a,b,c,d){var e=D,k=h;m.call(this,e,c);this.v=null;this.G=0;this.A=this.j=this.i=this.B=this.o=null;this.D=a;!1===d&&(this.g|=128);D=this;h=!0;if(0===I){J();I=1;try{this.h=a(b),0===L.g&&0===B.g||Q()}finally{I=0,D=null,h=!1}}else this.h=a(b);D=e;h=k}
g(P.prototype,{get:function(){var a=this.g;if(0===(a&6)&&0!==I){if(0!==(a&16)){if(0!==(a&8))throw Error();this.C()}h&&G(this)}return this.h}},{get:l});P.prototype.C=function(){var a,b,c=D,d=h;D=null;h=!1;var e=this.g,k=this.j;if(null!==k&&0!==(b=k.length)){for(a=0;a<b;a++)k[a](!1);k.length=0}D=this;(h=0===(e&1))&&R(this);this.g|=8;e=this.A;if(null!==e)try{this.h=this.D(this.h)}catch(w){b=e.length;for(a=0;a<b;a++)e[a](w);e.length=0}else this.h=this.D(this.h);this.g&=-25;D=c;h=d};
P.prototype.s=function(){this.D=null;v.call(this);r(this);R(this)};function S(a){this.i=a;this.h=[];this.g=0}function x(a,b){a.h[a.g++]=b}function T(a){I=a.i;for(var b=0,c=0;c<a.g;c++){var d=a.h[c],e=d.g;if(0!==(e&20))try{0!==(e&16)?d.C():d.s()}catch(k){b=1,0!==(e&16)&&(d.h=k,d.g|=64),d.g&=-25}a.h[c]=null}a.g=0;return b}var E={},I=0,B=new S(2),L=new S(3),y=new S(4),z=new S(5),D=null,h=!1;function J(){B.g=L.g=y.g=z.g=0}
function G(a){var b=D;a.g|=32;var c=null===b.v?-1:null===b.o?0:b.o.length;if(null===a.m){a.m=b;a.F=c;var d=-1}else null===a.l?(a.l=[b],a.u=[c],d=0):(d=a.l.length,a.l.push(b),a.u.push(c));null===b.v?(b.v=a,b.G=d):null===b.o?(b.o=[a],b.B=[d]):(b.o.push(a),b.B.push(d))}function K(){var a=D;try{Q()}finally{I=0,D=a,h=!1}}
function Q(){var a=0,b=0;do{0!==B.g&&(b+=T(B));0!==L.g&&(b+=T(L));0!==B.g&&(b+=T(B));0!==y.g&&(b+=T(y));0!==z.g&&(b+=T(z));if(0!==b)throw Error("Zorn: Error");if(1E5<a++)throw Error("Zorn: Cycle");}while(0!==L.g||0!==B.g||0!==y.g||0!==z.g)}function R(a){var b,c=a.v,d=a.o;null!==c&&(U(c,a.G),a.v=null);if(null!==d&&0!==(b=d.length))for(a=a.B;0!==b--;)U(d.pop(),a.pop())}
function U(a,b){if(0===(a.g&6))if(-1===b)a.m=null;else{var c=a.l;a=a.u;var d=c.pop(),e=a.pop();b!==c.length&&(c[b]=d,a[b]=e,-1===e?d.G=b:d.B[e]=b)}}function t(a,b){if(0===(a.g&6))if(-1===b)a.v=null;else{var c=a.o;a=a.B;var d=c.pop(),e=a.pop();b!==c.length&&(c[b]=d,a[b]=e,-1===e?d.F=b:d.u[e]=b)}}return{root:function(a){var b=new u,c=D,d=h;D=b;h=!1;if(0===I)try{a()}finally{D=c,h=d}else a(),D=c,h=d;return b},dispose:function(a){var b=a.g;0===(b&6)&&(0===I?a.s():(a.g=b&-17|4,x(B,a)))},val:function(a){return new f(a)},compute:function(a,b,c){return new P(a,b,1,c)},$compute:function(a,b,c){return new P(a,b,0,c)}
,when:function(a,b,c){var d=Array.isArray(a);if(d){var e=a.length;var k=Array(e)}return function(w){if(d)for(var q=0;q<e;q++)k[q]=a[q].val;else k=a.val;c?c=!1:(q=h,h=!1,w=b(k,w),h=q);return w}},data:function(a){return new C(a)},value:function(a,b){return new O(a,b)},nil:function(){return E},owner:function(){return D},freeze:function(a){if(0===I){J();I=1;try{var b=a();K()}finally{I=0}}else b=a();return b}
,recover:function(a){var b=D;null!==b&&(null===b.A?b.A=[a]:b.A.push(a))},cleanup:function(a){var b=D;null!==b&&(null===b.j?b.j=[a]:b.j.push(a))},Data:C,Value:O,Computation:P};})();