var Zorn=(function(){function f(a){this.g=a}g(f.prototype,{get:function(){return this.g()}},{get:function(){var a=h;h=!1;var b=this.g();h=a;return b}});function g(a,b,c){Object.defineProperties(a,{val:b,peek:c})}function l(){return this.h}function p(a,b,c){this.g=0|b;this.h=c;this.m=null;this.F=-1;this.u=this.l=null;null!==a&&(null===a.i?a.i=[this]:a.i.push(this))}function q(a){var b,c=a.m;a=a.l;null!==c&&r(c);if(null!==a&&0<(b=a.length))for(c=0;c<b;c++)r(a[c])}
function t(a){a.g=2;a.h=void 0;a.m=null;a.l=null;a.u=null;var b,c=a.m,d=a.l;null!==c&&(u(c,a.F),a.m=null);if(null!==d&&0!==(b=d.length))for(a=a.u;0!==b--;)u(d.pop(),a.pop())}function v(){this.g=0;this.A=this.j=this.i=null}function w(){this.g=2;this.h=void 0;var a,b,c=this.i,d=this.j;if(null!==c&&0!==(b=c.length))for(a=0;a<b;a++)c[a].s();this.i=null;if(null!==d&&0!==(b=d.length))for(a=0;a<b;a++)d[a](!0);this.j=null}v.prototype.C=function(){};v.prototype.s=w;
function r(a){var b=a.g;0===(b&6)&&0===(b&16)&&(a.g|=16,32===(b&160)?x(y,a):x(z,a),null!==a.i&&A(a.i),0!==(b&32)&&q(a))}function A(a){for(var b=a.length,c=0;c<b;c++){var d=a[c];d.g=4;x(B,d);d=d.i;null!==d&&(A(d),d.length=0)}}function C(a){p.call(this,D,0,a);this.i=E}function G(){0===(this.g&6)&&h&&H(this);return this.h}
function I(a){var b=this.g;if(0===(b&6))if(0===J)0!==(b&32)?(K(),this.h=a,q(this),L()):this.h=a;else if(this.i===E)this.i=a,this.g|=16,x(M,this);else if(a!==this.i)throw Error("Zorn: Conflict");return a}function N(){this.h=this.i;this.i=E;this.g&=-17;0!==(this.g&32)&&q(this)}function O(){t(this);this.i=void 0}g(C.prototype,{get:G,set:I},{get:l});C.prototype.C=N;C.prototype.s=O;function P(a,b){C.call(this,a);this.j=b}
g(P.prototype,{get:G,set:function(a){0===(this.g&6)&&((void 0===this.j?a===this.h:this.j(a,this.h))||I.call(this,a));return a}},{get:l});P.prototype.C=N;P.prototype.s=function(){this.j=null;O.call(this)};function Q(a,b,c,d){var e=D,k=h;p.call(this,e,c);this.v=null;this.G=0;this.A=this.j=this.i=this.B=this.o=null;this.D=a;!1===d&&(this.g|=128);D=this;h=!0;if(0===J){K();J=1;try{this.h=a(b),0===M.g&&0===B.g||R()}finally{J=0,D=null,h=!1}}else this.h=a(b);D=e;h=k}
g(Q.prototype,{get:function(){var a=this.g;if(0===(a&6)&&0!==J){if(0!==(a&16)){if(0!==(a&8))throw Error();this.C()}h&&H(this)}return this.h}},{get:l});Q.prototype.C=function(){var a,b,c=D,d=h;D=null;h=!1;var e=this.g,k=this.j;if(null!==k&&0!==(b=k.length)){for(a=0;a<b;a++)k[a](!1);k.length=0}D=this;(h=0===(e&1))&&S(this);this.g|=8;e=this.A;if(null!==e)try{this.h=this.D(this.h)}catch(n){b=e.length;for(a=0;a<b;a++)e[a](n);e.length=0}else this.h=this.D(this.h);this.g&=-25;D=c;h=d};
Q.prototype.s=function(){this.D=null;w.call(this);t(this);S(this)};function T(a){this.i=a;this.h=[];this.g=0}function x(a,b){a.h[a.g++]=b}function U(a){J=a.i;for(var b=0,c=0;c<a.g;c++){var d=a.h[c],e=d.g;if(0!==(e&20))try{0!==(e&16)?d.C():d.s()}catch(k){b=1,0!==(e&16)&&(d.h=k,d.g|=64),d.g&=-25}a.h[c]=null}a.g=0;return b}var E={},J=0,B=new T(2),M=new T(3),y=new T(4),z=new T(5),D=null,h=!1;function K(){B.g=M.g=y.g=z.g=0}
function H(a){var b=D;a.g|=32;var c=null===b.v?-1:null===b.o?0:b.o.length;if(null===a.m){a.m=b;a.F=c;var d=-1}else null===a.l?(a.l=[b],a.u=[c],d=0):(d=a.l.length,a.l.push(b),a.u.push(c));null===b.v?(b.v=a,b.G=d):null===b.o?(b.o=[a],b.B=[d]):(b.o.push(a),b.B.push(d))}function L(){var a=D;try{R()}finally{J=0,D=a,h=!1}}
function R(){var a=0,b=0;do{0!==B.g&&(b+=U(B));0!==M.g&&(b+=U(M));0!==B.g&&(b+=U(B));0!==y.g&&(b+=U(y));0!==z.g&&(b+=U(z));if(0!==b)throw Error("Zorn: Error");if(1E5<a++)throw Error("Zorn: Cycle");}while(0!==M.g||0!==B.g||0!==y.g||0!==z.g)}function S(a){var b,c=a.v,d=a.o;null!==c&&(V(c,a.G),a.v=null);if(null!==d&&0!==(b=d.length))for(a=a.B;0!==b--;)V(d.pop(),a.pop())}
function V(a,b){if(0===(a.g&6))if(-1===b)a.m=null;else{var c=a.l;a=a.u;var d=c.pop(),e=a.pop();b!==c.length&&(c[b]=d,a[b]=e,-1===e?d.G=b:d.B[e]=b)}}function u(a,b){if(0===(a.g&6))if(-1===b)a.v=null;else{var c=a.o;a=a.B;var d=c.pop(),e=a.pop();b!==c.length&&(c[b]=d,a[b]=e,-1===e?d.F=b:d.u[e]=b)}}return{root:function(a){var b=new v,c=D,d=h;D=b;h=!1;if(0===J)try{a()}finally{D=c,h=d}else a(),D=c,h=d;return b},dispose:function(a){var b=a.g;0===(b&6)&&(0===J?a.s():(a.g=b&-17|4,x(B,a)))},val:function(a){return new f(a)},compute:function(a,b,c){return new Q(a,b,1,c)},$compute:function(a,b,c){return new Q(a,b,0,c)}
,when:function(a,b,c){var d=Array.isArray(a);if(d){var e=a.length;var k=Array(e);var n=Array(e)}return function(F){if(d)for(var m=0;m<e;m++)n[m]=a[m].val;else n=a.val;c?c=!1:(m=h,h=!1,F=b(n,F,k),h=m);m=n;n=k;k=m;return F}},data:function(a){return new C(a)},value:function(a,b){return new P(a,b)},nil:function(){return E},owner:function(){return D},freeze:function(a){if(0===J){K();J=1;try{var b=a();L()}finally{J=0}}else b=a();return b}
,recover:function(a){var b=D;null!==b&&(null===b.A?b.A=[a]:b.A.push(a))},cleanup:function(a){var b=D;null!==b&&(null===b.j?b.j=[a]:b.j.push(a))},Data:C,Value:P,Computation:Q};})();