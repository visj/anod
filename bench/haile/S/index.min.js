(()=>{var v=function(t,e){var o=new y(t,e);return function(){return o.current()}};Object.defineProperty(v,"default",{value:v});var f=v;v.root=function(t){var e=p,o=t.length===0?B:new y(null,null),u=void 0,a=t.length===0?null:function(){g!==null?s.disposes.add(o):S(o)};return p=o,g===null?u=j(t,a,e):(u=a===null?t():t(a),p=e),u};function j(n,t,e){try{return t===null?n():n(t)}finally{p=e}}v.on=function(t,e,o,u){return Array.isArray(t)&&(t=W(t)),u=!!u,v(a,o);function a(r){var i=c;return t(),u?u=!1:(c=null,r=e(r),c=i),r}};function W(n){return function(){for(var e=0;e<n.length;e++)n[e]()}}v.effect=function(t,e){new y(t,e)};v.data=function(t){var e=new k(t);return function(u){return arguments.length===0?e.current():e.next(u)}};v.value=function(t,e){var o=v.data(t),u=-1;return function(r){if(arguments.length===0)return o();var i=e?e(t,r):t===r;if(!i){var C=s.time;if(u===C)throw new Error("conflicting values: "+r+" is not the same as "+t);u=C,t=r,o(r)}return r}};v.freeze=function(t){var e=void 0;if(g!==null)e=t();else{g=s,g.changes.reset();try{e=t(),b()}finally{g=null}}return e};v.sample=function(t){var e,o=c;return o!==null?(c=null,e=t(),c=o):e=t(),e};v.cleanup=function(t){p!==null?p.cleanups===null?p.cleanups=[t]:p.cleanups.push(t):console.warn("cleanups created without a root or parent will never be run")};v.makeDataNode=function(t){return new k(t)};v.makeComputationNode=function(t,e){return new y(t,e)};v.isFrozen=function(){return g!==null};v.isListening=function(){return c!==null};var _=function(){function n(){this.time=0,this.changes=new N,this.updates=new N,this.disposes=new N}return n}(),F={time:function(){return s.time}},k=function(){function n(t){this.value=t,this.pending=R,this.log=null}return n.prototype.current=function(){return c!==null&&H(this,c),this.value},n.prototype.next=function(t){if(g!==null)if(this.pending!==R){if(t!==this.pending)throw new Error("conflicting changes: "+t+" !== "+this.pending)}else this.pending=t,s.changes.add(this);else this.log!==null?(this.pending=t,s.changes.add(this),b()):this.value=t;return t},n.prototype.clock=function(){return F},n}(),y=function(){function n(t,e){if(this.state=D,this.source1=null,this.source1slot=0,this.sources=null,this.sourceslots=null,this.log=null,this.owned=null,this.cleanups=null,this.fn=t,this.value=e,this.age=s.time,t!==null){var o=p,u=c;o===null&&console.warn("computations created without a root or parent will never be disposed"),p=c=this,g===null?K(this):this.value=this.fn(this.value),p=o,c=u}}return n.prototype.current=function(){if(c!==null){if(this.age===s.time){if(this.state===T)throw new Error("circular dependency");P(this)}J(this,c)}return this.value},n.prototype.clock=function(){return F},n}(),L=function(){function n(){this.node1=null,this.node1slot=0,this.nodes=null,this.nodeslots=null}return n}(),N=function(){function n(){this.items=[],this.count=0}return n.prototype.reset=function(){this.count=0},n.prototype.add=function(t){this.items[this.count++]=t},n.prototype.run=function(t){for(var e=this.items,o=0;o<this.count;o++)t(e[o]),e[o]=null;this.count=0},n}(),R={},D=0,O=1,T=2,s=new _,g=null,c=null,p=null,B=new y(null,null);function $(n,t){var e,o=t.source1===null?-1:t.sources===null?0:t.sources.length;n.node1===null?(n.node1=t,n.node1slot=o,e=-1):n.nodes===null?(n.nodes=[t],n.nodeslots=[o],e=0):(e=n.nodes.length,n.nodes.push(t),n.nodeslots.push(o)),t.source1===null?(t.source1=n,t.source1slot=e):t.sources===null?(t.sources=[n],t.sourceslots=[e]):(t.sources.push(n),t.sourceslots.push(e))}function H(n,t){n.log===null&&(n.log=new L),$(n.log,t)}function J(n,t){n.log===null&&(n.log=new L),$(n.log,t)}function b(){var n=p;s.updates.reset(),s.time++;try{z(s)}finally{g=c=null,p=n}}function K(n){g=s,s.changes.reset(),s.updates.reset();try{n.value=n.fn(n.value),(s.changes.count>0||s.updates.count>0)&&(s.time++,z(s))}finally{g=p=c=null}}function z(n){var t=g,e=0;for(g=n,n.disposes.reset();n.changes.count!==0||n.updates.count!==0||n.disposes.count!==0;)if(e>0&&n.time++,n.changes.run(M),n.updates.run(P),n.disposes.run(S),e++>1e5)throw new Error("Runaway clock detected");g=t}function M(n){n.value=n.pending,n.pending=R,n.log&&A(n.log)}function A(n){var t=n.node1,e=n.nodes;if(t!==null&&x(t),e!==null)for(var o=0,u=e.length;o<u;o++)x(e[o])}function x(n){var t=s.time;n.age<t&&(n.age=t,n.state=O,s.updates.add(n),n.owned!==null&&U(n.owned),n.log!==null&&A(n.log))}function U(n){for(var t=0;t<n.length;t++){var e=n[t];e.age=s.time,e.state=D,e.owned!==null&&U(e.owned)}}function P(n){if(n.state===O){var t=p,e=c;p=c=n,n.state=T,G(n,!1),n.value=n.fn(n.value),n.state=D,p=t,c=e}}function G(n,t){var e=n.source1,o=n.sources,u=n.sourceslots,a=n.cleanups,r=n.owned,i,C;if(a!==null){for(i=0;i<a.length;i++)a[i](t);n.cleanups=null}if(r!==null){for(i=0;i<r.length;i++)S(r[i]);n.owned=null}if(e!==null&&(E(e,n.source1slot),n.source1=null),o!==null)for(i=0,C=o.length;i<C;i++)E(o.pop(),u.pop())}function E(n,t){var e=n.nodes,o=n.nodeslots,u,a;t===-1?n.node1=null:(u=e.pop(),a=o.pop(),t!==e.length&&(e[t]=u,o[t]=a,a===-1?u.source1slot=t:u.sourceslots[a]=t))}function S(n){n.fn=null,n.log=null,G(n,!0)}function I(){return performance.now()}var l=1e6,Q=[];function m(n){Q.push(n)}V();console.log(Q.join(`
`));function V(){var n=0;n+=h(w,l,l),n+=h(Z,l,0),n+=h(on,l,l),n+=h(un,l/2,l),n+=h(rn,l/4,l),n+=h(ln,l/1e3,l),n+=h(en,l,l/2),n+=h(tn,l,l/4),n+=h(nn,l,l/8),n+=h(q,l,l/1e3),m("---");var t=0;t+=h(pn,l*4,1),t+=h(vn,l*2,2),t+=h(hn,l,4),t+=h(dn,l/100,1e3),t+=h(gn,l*4,1),t+=h(mn,l*4,1),t+=h(wn,l*4,1),m("---"),m(`create total: ${n.toFixed(0)}`),m(`update total: ${t.toFixed(0)}`),m(`total: ${(n+t).toFixed(0)}`)}function h(n,t,e){var o=Y(n,t,e);return X(n.name,{ms:o,mem:0}),o}function X(n,t){m(`${n.padEnd(30)} ${t.ms.toFixed(1).padStart(5)} ${(t.mem/1e3).toFixed(0).padStart(10)}`)}function Y(n,t,e){var o,u;return f.root(function(a){var r=w(e,[]);n(t/100,r),r=w(e,[]),n(t/100,r),r=w(e,[]),n(t/100,r),r=w(e,[]);for(var i=0;i<e;i++)r[i](),r[i](),r[i]();a()}),f.root(function(a){var r=w(e,[]);o=I(),n(t,r),u=I(),r=null,a()}),u-o}function w(n,t){for(var e=0;e<n;e++)t[e]=f.data(e);return t}function Z(n,t){for(var e=0;e<n;e++)an(e)}function q(n,t){for(var e=0;e<n/1e3;e++)for(var o=0;o<1e3;o++)d(t[e])}function nn(n,t){for(var e=0;e<n/8;e++)d(t[e]),d(t[e]),d(t[e]),d(t[e]),d(t[e]),d(t[e]),d(t[e]),d(t[e])}function tn(n,t){for(var e=0;e<n/4;e++)d(t[e]),d(t[e]),d(t[e]),d(t[e])}function en(n,t){for(var e=0;e<n/2;e++)d(t[e]),d(t[e])}function on(n,t){for(var e=0;e<n;e++)d(t[e])}function un(n,t){for(var e=0;e<n;e++)sn(t[e*2],t[e*2+1])}function rn(n,t){for(var e=0;e<n;e++)fn(t[e*4],t[e*4+1],t[e*4+2],t[e*4+3])}function ln(n,t){for(var e=0;e<n;e++)cn(t,e*1e3)}function an(n){f(function(){return n})}function d(n){f(function(){return n()})}function sn(n,t){f(function(){return n()+t()})}function fn(n,t,e,o){f(function(){return n()+t()+e()+o()})}function cn(n,t){f(function(){for(var e=0,o=0;o<1e3;o++)e+=n[t+o]();return e})}function pn(n,t){var e=t[0];f(function(){return e()});for(var o=0;o<n;o++)e(o)}function vn(n,t){var e=t[0],o=t[1];f(function(){return e()+o()});for(var u=0;u<n;u++)e(u)}function hn(n,t){var e=t[0],o=t[1],u=t[2],a=t[3];f(function(){return e()+o()+u()+a()});for(var r=0;r<n;r++)e(r)}function dn(n,t){var e=t[0];f(function(){for(var u=0,a=0;a<1e3;a++)u+=t[a]();return u});for(var o=0;o<n;o++)e(o)}function gn(n,t){var e=t[0];f(function(){return e()}),f(function(){return e()});for(var o=0;o<n/2;o++)e(o)}function mn(n,t){var e=t[0];f(function(){return e()}),f(function(){return e()}),f(function(){return e()}),f(function(){return e()});for(var o=0;o<n/4;o++)e(o)}function wn(n,t){for(var e=t[0],o=0;o<1e3;o++)f(function(){return e()});for(var o=0;o<n/1e3;o++)e(o)}})();
